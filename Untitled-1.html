<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fitness Tracker</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#00d4ff; --accent-2:#7b61ff; --glass: rgba(255,255,255,0.04);
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    body{margin:0; min-height:100vh; background:linear-gradient(180deg,#071026 0%,var(--bg) 100%); color:#e6eef6; padding:28px;}
    .app{max-width:1100px; margin:0 auto; display:grid; grid-template-columns: 1fr 420px; gap:22px; align-items:start}
    header{grid-column:1/-1; display:flex; justify-content:space-between; align-items:center; margin-bottom:8px}
    h1{font-size:20px; margin:0}
    .subtitle{color:var(--muted); font-size:13px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; padding:18px; box-shadow: 0 6px 18px rgba(2,6,23,0.6);}
    .input-row{display:flex; gap:10px; margin-bottom:10px}
    label{font-size:12px; color:var(--muted)}
    input[type=text], input[type=number], input[type=date], select{background:var(--glass); border:1px solid rgba(255,255,255,0.03); padding:10px 12px; border-radius:10px; color:inherit; width:100%}
    button{background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#041025; border:0; padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer}
    .muted{color:var(--muted); font-size:13px}
    .activities{max-height:420px; overflow:auto; margin-top:12px}
    .activity{display:flex; gap:12px; align-items:center; padding:10px; border-radius:10px; margin-bottom:10px; background:rgba(255,255,255,0.02)}
    .badge{padding:6px 8px; border-radius:8px; font-weight:700; font-size:13px}
    .type{min-width:110px}
    .meta{flex:1}
    .meta .title{font-weight:700}
    .meta .small{color:var(--muted); font-size:13px}
    .actions button{background:transparent; color:var(--muted); border:0; cursor:pointer; padding:6px}
    .summary{display:flex; gap:12px; margin-top:12px}
    .stat{flex:1; text-align:center; padding:12px; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));}
    canvas{width:100% !important; height:200px !important; border-radius:10px}
    footer{grid-column:1/-1; color:var(--muted); margin-top:14px; font-size:13px}
    @media (max-width:980px){ .app{grid-template-columns:1fr; padding:12px} }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>FitTrack ‚Äî Personal fitness tracker</h1>
        <div class="subtitle">Log workouts, track minutes & calories, see weekly progress</div>
      </div>
      <div class="muted">Local first ‚Ä¢ Data stored in your browser</div>
    </header>

    <section class="card" aria-labelledby="logHeading">
      <h2 id="logHeading" style="margin-top:0">Add an activity</h2>
      <div style="margin-top:6px;" class="muted">Quickly add workout sessions (or manual entries).</div>

      <form id="entryForm" style="margin-top:12px">
        <div class="input-row">
          <div style="flex:1">
            <label>Type</label>
            <select id="type" required>
              <option>Running</option>
              <option>Cycling</option>
              <option>Walking</option>
              <option>Swimming</option>
              <option>Strength</option>
              <option>Yoga</option>
              <option>Other</option>
            </select>
          </div>
          <div style="width:120px">
            <label>Date</label>
            <input id="date" type="date" required />
          </div>
        </div>
        <div class="input-row">
          <div style="flex:1">
            <label>Duration (minutes)</label>
            <input id="duration" type="number" min="1" step="1" placeholder="e.g. 45" required />
          </div>
          <div style="width:140px">
            <label>Calories (kcal)</label>
            <input id="calories" type="number" min="0" step="1" placeholder="e.g. 350" required />
          </div>
        </div>
        <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
          <button id="addBtn">Add activity</button>
          <button id="updateBtn" type="button" style="display:none;background:#334155;color:#e6eef6">Update</button>
          <button id="cancelEdit" type="button" style="display:none;background:transparent;color:var(--muted)">Cancel</button>
          <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
            <button id="exportCsv" type="button" style="background:transparent;color:var(--muted);">Export CSV</button>
            <button id="clearAll" type="button" style="background:transparent;color:var(--muted);">Clear all</button>
          </div>
        </div>
      </form>

      <div class="summary" aria-live="polite">
        <div class="stat">
          <div class="muted">Total Minutes</div>
          <div id="totalMinutes" style="font-size:20px;font-weight:800">0</div>
        </div>
        <div class="stat">
          <div class="muted">Total Calories</div>
          <div id="totalCalories" style="font-size:20px;font-weight:800">0</div>
        </div>
        <div class="stat">
          <div class="muted">Sessions</div>
          <div id="countSessions" style="font-size:20px;font-weight:800">0</div>
        </div>
      </div>

    </section>

    <aside class="card">
      <h3 style="margin-top:0">Weekly progress</h3>
      <div class="muted">Totals by day (last 7 days)</div>
      <canvas id="progressChart" aria-label="weekly progress chart" role="img"></canvas>

      <div style="margin-top:12px">
        <h4 style="margin:0 0 6px 0">Activities</h4>
        <div class="activities" id="activitiesList" aria-live="polite"></div>
      </div>
    </aside>

    <footer>
      Tip: Use the date field to add past activities. This app stores data in your browser's Local Storage ‚Äî export CSV to backup.
    </footer>
  </div>

  <script>
    // ----- Data & Helpers -----
    const STORAGE_KEY = 'fittrack.entries.v1';
    let entries = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    let editingId = null;

    // DOM
    const form = document.getElementById('entryForm');
    const typeEl = document.getElementById('type');
    const dateEl = document.getElementById('date');
    const durationEl = document.getElementById('duration');
    const caloriesEl = document.getElementById('calories');
    const addBtn = document.getElementById('addBtn');
    const updateBtn = document.getElementById('updateBtn');
    const cancelEdit = document.getElementById('cancelEdit');
    const activitiesList = document.getElementById('activitiesList');
    const totalMinutes = document.getElementById('totalMinutes');
    const totalCalories = document.getElementById('totalCalories');
    const countSessions = document.getElementById('countSessions');
    const exportCsv = document.getElementById('exportCsv');
    const clearAll = document.getElementById('clearAll');
    const chartCanvas = document.getElementById('progressChart');
    const ctx = chartCanvas.getContext('2d');

    // seed date default to today
    dateEl.value = new Date().toISOString().slice(0,10);

    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(entries)); }

    function uid(){ return 'id_' + Math.random().toString(36).slice(2,9); }

    function formatDate(d){ const dt = new Date(d); return dt.toLocaleDateString(); }

    // ----- Render -----
    function renderList(){
      activitiesList.innerHTML = '';
      if(entries.length === 0){ activitiesList.innerHTML = '<div class="muted">No activities yet ‚Äî add your first session above.</div>'; }
      entries.slice().reverse().forEach(e=>{
        const el = document.createElement('div'); el.className='activity';
        el.innerHTML = `
          <div class="badge type" style="background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01))">${escapeHtml(e.type)}</div>
          <div class="meta">
            <div class="title">${escapeHtml(e.type)} ‚Äî ${formatDate(e.date)}</div>
            <div class="small">${e.duration} min ‚Ä¢ ${e.calories} kcal</div>
          </div>
          <div class="actions">
            <button aria-label="edit" data-id="${e.id}" class="editBtn">‚úèÔ∏è</button>
            <button aria-label="delete" data-id="${e.id}" class="delBtn">üóëÔ∏è</button>
          </div>
        `;
        activitiesList.appendChild(el);
      });
      updateSummary();
      drawChart();
    }

    function updateSummary(){
      const totalMin = entries.reduce((s,i)=>s + (Number(i.duration)||0),0);
      const totalCal = entries.reduce((s,i)=>s + (Number(i.calories)||0),0);
      totalMinutes.textContent = totalMin;
      totalCalories.textContent = totalCal;
      countSessions.textContent = entries.length;
    }

    // ----- Form actions -----
    form.addEventListener('submit', e=>{ e.preventDefault(); if(editingId) return; addEntry(); });

    function addEntry(){
      const entry = {
        id: uid(),
        type: typeEl.value,
        date: dateEl.value,
        duration: Number(durationEl.value)||0,
        calories: Number(caloriesEl.value)||0,
        createdAt: new Date().toISOString()
      };
      entries.push(entry); save(); renderList(); form.reset(); dateEl.value = new Date().toISOString().slice(0,10);
    }

    activitiesList.addEventListener('click', (ev)=>{
      const id = ev.target.getAttribute('data-id');
      if(!id) return;
      if(ev.target.classList.contains('delBtn')){ if(confirm('Delete this activity?')){ entries = entries.filter(x=>x.id!==id); save(); renderList(); } }
      if(ev.target.classList.contains('editBtn')){ startEdit(id); }
    });

    function startEdit(id){
      const e = entries.find(x=>x.id===id); if(!e) return;
      editingId = id; typeEl.value = e.type; dateEl.value = e.date; durationEl.value = e.duration; caloriesEl.value = e.calories;
      addBtn.style.display='none'; updateBtn.style.display='inline-block'; cancelEdit.style.display='inline-block';
    }

    updateBtn.addEventListener('click', ()=>{
      if(!editingId) return;
      const idx = entries.findIndex(x=>x.id===editingId); if(idx===-1) return;
      entries[idx].type = typeEl.value; entries[idx].date = dateEl.value; entries[idx].duration = Number(durationEl.value)||0; entries[idx].calories = Number(caloriesEl.value)||0;
      save(); renderList(); stopEdit();
    });

    cancelEdit.addEventListener('click', stopEdit);
    function stopEdit(){ editingId = null; addBtn.style.display='inline-block'; updateBtn.style.display='none'; cancelEdit.style.display='none'; form.reset(); dateEl.value = new Date().toISOString().slice(0,10); }

    // ----- CSV Export -----
    exportCsv.addEventListener('click', ()=>{
      if(entries.length===0){ alert('No data to export'); return; }
      const rows = [['id','type','date','duration','calories','createdAt']];
      entries.forEach(r=>rows.push([r.id, r.type, r.date, r.duration, r.calories, r.createdAt]));
      const csv = rows.map(r => r.map(c => '"'+String(c).replace(/"/g,'""')+'"').join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'fittrack.csv'; a.click(); URL.revokeObjectURL(url);
    });

    clearAll.addEventListener('click', ()=>{
      if(!confirm('Clear ALL entries? This cannot be undone.')) return;
      entries = []; save(); renderList();
    });

    // ----- Chart (simple canvas drawing) -----
    function lastNDates(n){ const arr=[]; for(let i=n-1;i>=0;i--){ const d=new Date(); d.setDate(d.getDate()-i); arr.push(d); } return arr; }

    function drawChart(){
      const days = lastNDates(7);
      // compute totals per day
      const totals = days.map(d=>{
        const day = d.toISOString().slice(0,10);
        return entries.filter(e=>e.date===day).reduce((s,i)=>s + (Number(i.duration)||0),0);
      });

      // clear
      ctx.clearRect(0,0,chartCanvas.width,chartCanvas.height);
      // resize for high DPI
      const dpr = window.devicePixelRatio || 1; const w = chartCanvas.clientWidth; const h = 200; chartCanvas.width = Math.floor(w * dpr); chartCanvas.height = Math.floor(h * dpr); ctx.scale(dpr,dpr);

      // axis and grid
      const pad = 28; const cw = w - pad*2; const ch = h - pad*2; const max = Math.max(10, ...totals);
      ctx.font = '12px Inter, system-ui'; ctx.fillStyle = 'rgba(255,255,255,0.85)';
      // compute points
      const points = totals.map((val,i)=>{
        const x = pad + (i/(totals.length-1 || 1)) * cw;
        const y = pad + (1 - (val/max)) * ch;
        return {x,y,val}
      });
      // grid lines
      ctx.strokeStyle = 'rgba(255,255,255,0.04)'; ctx.lineWidth = 1;
      for(let i=0;i<=4;i++){ const y = pad + (i/4)*ch; ctx.beginPath(); ctx.moveTo(pad,y); ctx.lineTo(pad+cw,y); ctx.stroke(); }

      // area fill
      ctx.beginPath(); ctx.moveTo(points[0].x, pad+ch);
      points.forEach(p=>ctx.lineTo(p.x,p.y));
      ctx.lineTo(points[points.length-1].x, pad+ch);
      const grad = ctx.createLinearGradient(pad,0,pad,ch); grad.addColorStop(0,'rgba(0,212,255,0.18)'); grad.addColorStop(1,'rgba(123,97,255,0.02)'); ctx.fillStyle = grad; ctx.fill();

      // line
      ctx.beginPath(); ctx.lineWidth = 2.2; ctx.strokeStyle = 'rgba(0,212,255,0.92)'; points.forEach((p,i)=> i?ctx.lineTo(p.x,p.y):ctx.moveTo(p.x,p.y)); ctx.stroke();

      // dots + labels
      points.forEach((p,i)=>{
        ctx.beginPath(); ctx.arc(p.x,p.y,3.5,0,Math.PI*2); ctx.fillStyle='white'; ctx.fill();
        ctx.fillStyle='rgba(255,255,255,0.75)'; ctx.font='11px Inter'; const label = String(p.val)+'m'; ctx.fillText(label, p.x-12, p.y-10);
      });

      // x labels
      ctx.fillStyle='rgba(255,255,255,0.7)'; ctx.font='11px Inter'; points.forEach((p,i)=>{ const d=days[i]; const lbl = d.toLocaleDateString(undefined,{weekday:'short'}); ctx.fillText(lbl, p.x-16, pad+ch+20); });

      // reset scale for future draws
      ctx.setTransform(1,0,0,1,0,0);
    }

    // ----- Utilities -----
    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // initial render
    renderList();

    // resize chart on window resize
    window.addEventListener('resize', ()=>{ drawChart(); });

  </script>
</body>
</html>
